<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<link rel="stylesheet" title="Default Style" href="styles/default/main.css" type="text/css">
<link rel="stylesheet" href="styles/default/xultu.css" type="text/css">


<link rel="stylesheet" href="styles/default/xultu-print.css" type="text/css" media="print">


<link rel="home"   href="http://www.xulplanet.com/"            title="http://www.XulPlanet.com/">
<link rel="search" href="http://www.xulplanet.com/cgi-bin/search/search.cgi" title="Search XulPlanet">
<link rel="author" href="http://www.xulplanet.com/ndeakin" title="Neil Deakin">
 <link rel="up" href="http://www.xulplanet.com/tutorials/" title="Up"> 
 <link rel="first" href="intro.html" title="First"> 
 <link rel="last" href="end.html" title="Last"> 

 <link rel="prev" href="xpinstall.html"> 
 <link rel="next" href="xpiadv.html"> 

<meta name="Description" content="Step by step tutorial of the XML User Interface Language">

<title>XulPlanet.com - Install Scripts</title>

</head>
<body>

<div id="header">
  <a href="http://www.xulplanet.com/">
    <img id="logo" src="images/xulplanet.png" width="215" height="65" alt="XUL Planet">
  </a>

<div id="locationlinks">
  <a href="http://www.xulplanet.com/">Home</a> &gt;

  <a href="http://www.xulplanet.com/tutorials/">Tutorials</a> :


  <a href="index.html">XUL Tutorial</a> :



 13.2 - Install Scripts 
</div>



</div>



<hr class="edgesplit">

<div id="sidebar">

<div id="search">
  <form action="/cgi-bin/search/search.cgi" method="get">
    Search:<br>
    <input id="search-box" name="Terms" type="text">
    <input type="submit" value="Go">
  </form>
</div>

<hr>

<ul class="sidebar-section-links">
  <li><a href="http://www.xulplanet.com/tutorials/xultu/allofit.zip">Single Document Version</a></li>
  <li><a href="http://www.xulplanet.com/tutorials/xultu/xultu.zip">Download the XUL Tutorial</a><br></li>
  <li><a href="http://www.xulplanet.com/references/elemref/">Element Reference</a></li>
  <li><a href="http://www.xulplanet.com/references/elemref/quickref.html">Quick Reference</a><br></li>
  <li><a href="keyref.html">Key Code Reference</a></li>
  <li><a href="templateex.html">Template Syntax Examples</a></li>
</ul>

<hr>



<OL id="sidebar-docs-index">
  <LI class="sidebar-section-title">Introduction
  <OL>
    <LI> <A HREF="intro.html">Introduction</A></LI>
    <LI> <A HREF="xulfile.html">XUL Structure</A></LI>
    <LI> <A HREF="chromeurl.html">The Chrome URL</A></LI>
    <LI> <A HREF="packaging.html">Contents.rdf Files</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Simple Elements
  <OL>
    <LI> <A HREF="window.html">Creating a Window</A></LI>
    <LI> <A HREF="buttons.html">Adding Buttons</A></LI>
    <LI> <A HREF="textimage.html">Adding Labels and Images</A></LI>
    <LI> <A HREF="inputs.html">Input Controls</A></LI>
    <LI> <A HREF="lists.html">List Controls</A></LI>
    <LI> <A HREF="progress.html">Progress Meters</A></LI>
    <LI> <A HREF="htmlelem.html">Adding HTML Elements</A></LI>
    <LI> <A HREF="springs.html">Using Spacers</A></LI>
    <LI> <A HREF="advbtns.html">More Button Features</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">The Box Model
  <OL>
    <LI> <A HREF="boxes.html">The Box Model</A></LI>
    <LI> <A HREF="boxstyle.html">Element Positioning</A></LI>
    <LI> <A HREF="boxdet.html">Box Model Details</A></LI>
    <LI> <A HREF="titledbox.html">Groupboxes</A></LI>
    <LI> <A HREF="boxfinal.html">Adding More Elements</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">More Layout Elements
  <OL>
    <LI> <A HREF="stacks.html">Stacks and Decks</A></LI>
    <LI> <A HREF="bulletins.html">Stack Positioning</A></LI>
    <LI> <A HREF="tabpanel.html">Tabboxes</A></LI>
    <LI> <A HREF="grids.html">Grids</A></LI>
    <LI> <A HREF="cpanels.html">Content Panels</A></LI>
    <LI> <A HREF="splitter.html">Splitters</A></LI>
    <LI> <A HREF="scroll.html">Scroll Bars</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Toolbars and Menus
  <OL>
    <LI> <A HREF="toolbar.html">Toolbars</A></LI>
    <LI> <A HREF="menubar.html">Simple Menu Bars</A></LI>
    <LI> <A HREF="advmenu.html">More Menu Features</A></LI>
    <LI> <A HREF="popups.html">Popup Menus</A></LI>
    <LI> <A HREF="menuscroll.html">Scrolling Menus</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Events and Scripts
  <OL>
    <LI> <A HREF="events.html">Adding Event Handlers</A></LI>
    <LI> <A HREF="advevents.html">More Event Handlers</A></LI>
    <LI> <A HREF="keyshort.html">Keyboard Shortcuts</A></LI>
    <LI> <A HREF="focus.html">Focus and Selection</A></LI>
    <LI> <A HREF="commands.html">Commands</A></LI>
    <LI> <A HREF="commandupdate.html">Updating Commands</A></LI>
    <LI> <A HREF="broadob.html">Broadcasters and Observers</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Document Object Model
  <OL>
    <LI> <A HREF="dom.html">Document Object Model</A></LI>
    <LI> <A HREF="dommodify.html">Modifying a XUL Interface</A></LI>
    <LI> <A HREF="domlists.html">Manipulating Lists</A></LI>
    <LI> <A HREF="boxobject.html">Box Objects</A></LI>
    <LI> <A HREF="xpcom.html">XPCOM Interfaces</A></LI>
    <LI> <A HREF="xpcomex.html">XPCOM Examples</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Trees
  <OL>
    <LI> <A HREF="trees.html">Trees</A></LI>
    <LI> <A HREF="advtrees.html">More Tree Features</A></LI>
    <LI> <A HREF="seltree.html">Tree Selection</A></LI>
    <LI> <A HREF="treeview.html">Custom Tree Views</A></LI>
    <LI> <A HREF="treeviewdet.html">Tree View Details</A></LI>
    <LI> <A HREF="treeboxobject.html">Tree Box Objects</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">RDF and Templates
  <OL>
    <LI> <A HREF="intrordf.html">Introduction to RDF</A></LI>
    <LI> <A HREF="templates.html">Templates</A></LI>
    <LI> <A HREF="treetempl.html">Trees and Templates</A></LI>
    <LI> <A HREF="datasrc.html">RDF Datasources</A></LI>
    <LI> <A HREF="advrules.html">Advanced Rules</A></LI>
    <LI> <A HREF="persist.html">Persistent Data</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Skins and Locales
  <OL>
    <LI> <A HREF="style.html">Adding Style Sheets</A></LI>
    <LI> <A HREF="treestyle.html">Styling a Tree</A></LI>
    <LI> <A HREF="defskin.html">Modifying the Default Skin</A></LI>
    <LI> <A HREF="cskin.html">Creating a Skin</A></LI>
    <LI> <A HREF="locale.html">Localization</A></LI>
    <LI> <A HREF="locprops.html">Property Files</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Bindings
  <OL>
    <LI> <A HREF="introxbl.html">Introduction to XBL</A></LI>
    <LI> <A HREF="xblcontent.html">Anonymous Content</A></LI>
    <LI> <A HREF="xblatin.html">XBL Attribute Inheritance</A></LI>
    <LI> <A HREF="xblprops.html">Adding Properties</A></LI>
    <LI> <A HREF="xblmethods.html">Adding Methods</A></LI>
    <LI> <A HREF="xblevents.html">Adding Event Handlers</A></LI>
    <LI> <A HREF="xblinherit.html">XBL Inheritance</A></LI>
    <LI> <A HREF="xblex.html">XBL Example</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Specialized Window Types
  <OL>
    <LI> <A HREF="featwin.html">Features of a Window</A></LI>
    <LI> <A HREF="dialogs.html">Creating Dialogs</A></LI>
    <LI> <A HREF="filedialog.html">Open and Save Dialogs</A></LI>
    <LI> <A HREF="wizard.html">Creating a Wizard</A></LI>
    <LI> <A HREF="advwiz.html">More Wizards</A></LI>
    <LI> <A HREF="overlay.html">Overlays</A></LI>
    <LI> <A HREF="crosspov.html">Cross Package Overlays</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Installation
  <OL>
    <LI> <A HREF="xpinstall.html">Creating an Installer</A></LI>
    <LI> <SPAN CLASS="currentpage">Install Scripts</SPAN></LI>
    <LI> <A HREF="xpiadv.html">Additional Install Features</A></LI>
  </OL>
</OL>

</div>



<div id="content">

<div class="navlinks-pnc">

  <a class="prevlink" title="13.1 - Creating an Installer"
     href="xpinstall.html">Previous</a>


  <a class="nextlink" title="13.3 - Additional Install Features"
     href="xpiadv.html">Next</a>

</div>

<div class="xultu-content">

<h2>Install Scripts</h2>

<P>
This section describes the install script.
</P>

<H3>Creating an Install Script</H3>

<P>
You will usually want some form of control over your install process. For example,
you may wish to check versions of files and only install updated files, or perhaps
you wish to apply patches to existing files. The install script is even flexible
enough to allow you to uninstall files. For this reason, installers include an
install script to handle the installation process.
</P>

<P>
The installer script must be called install.js and must be placed at the top level
of the installer archive. The script will contain JavaScript code which calls a
number of install functions.
</P>

<P>
In an HTML document, or a XUL document, the window object is the root global object.
That means that you can call the methods of the window object with the qualifier
before it, which means that window.open(...) can simply be written open(...). In
an install script, there is no associated window, however the global object will be
an Install object which contains a number of functions to customize the install
process. Some of the Install object's functions will be described below.
</P>

<P>
The install script should take the following steps:
</P>

<OL>
  <LI>Initialize the installation by specifying what package and version is being
      installed.</LI>
  <LI>Use the Install functions to indicate what files and directories need to be
      installed. You can also set files to be moved and deleted.</LI>
  <LI>Start the process of installing the necessary files.</LI>
</OL>

<P>
It is important to note that during step two, you only indicate which files should
be installed and any other operations you wish to have happen. No files get copied
until step three. Because of this, you can easily specify a number of files to be
installed, come across some kind of error, and abort the whole process without
modifying the user's system.
</P>

<H3>The Component Registry</H3>

<P>
Mozilla maintains a file which is a registry of all the components that are currently
installed. Components include new chrome packages, skins and plugins. When a new
component is installed, the registry gets updated. The registry also stores the set of
files and version information about the installed components. That way, it is easier to
check if a version of your component is already present and only update it if necessary.
</P>

<P>
The component registry works somewhat like the Windows registry does. It consists
of a hierarchy of keys and values. You don't need to know much about it to
create XUL applications unless you are creating your own XPCOM components.
</P>

<P>
What you do need to know for an installation is that the registry stores a set of
information about your application, such as the file list and versions. All of this
information is stored in a key (and within subkeys) that you provide in the
installation script (in step 1 mentioned above).
</P>

<P>
This key is structured as directory-like path of the following form:
</P>


<DIV CLASS="sample"><PRE>/Author/Package Name</PRE></DIV>



<P>
Replace the word Author with your name and replace the Package Name with the name
of the package that you are installing. For example:
</P>


<DIV CLASS="sample"><PRE>/Xulplanet/Find Files

/Netscape/Personal Security Manager</PRE></DIV>



<P>
The first example is what we'll use for the find files dialog. The second is the
key used for the Personal Security Manager.
</P>

<H3>Install Initialization</H3>

<P>
The Install object has a function, initInstall which can be used to initialize for
the installation. It should be called at the beginning of your installation script.
The syntax of this function is as follows:
</P>


<DIV CLASS="sample"><PRE>initInstall( packageName , regPackage , version );

<B>Example:</B>

initInstall("Find Files","/Xulplanet/Find Files","0.5.0.0");</PRE></DIV>



<P>
The first argument is the name of the package in user-readable form. The second argument
is the registry key used to hold the package information as described earlier. The
third argument is the version of the package being installed.
</P>

<P>
Next, we need to set the directory where the files will be installed. There are two
ways to do this. The simple method assigns an install directory and installs all files
into it. The second method allows you to assign a destination on a per-file (or directory)
basis. The first method is described below.
</P>

<P>
The function setPackageFolder assigns an installation directory. For the find files
dialog, we will install the files into the chrome directory. (We could actually put
them anywhere though.) The setPackageFolder takes one argument, the directory to install
to. For maximum portability, you can't specify a string name for the directory. Instead,
you specify an identifier of a known directory and get subdirectories of it. Thus, if
your application needed to install some system libraries, you don't need to know the
name of those directories.
</P>

<P>
The directory identifiers are listed in the
<A HREF="http://www.xulplanet.com/references/elemref/ref_Install.html#prop_getFolder">reference</A>.
For the chrome directory, the directory identifier is 'Chrome'. The getFolder function
can be used to get one of these special directories. This function takes two
arguments, the first is the identifier and the second is a subdirectory. For
example:
</P>


<DIV CLASS="sample"><PRE>findDir = getFolder("Chrome","findfile");
setPackageFolder(findDir);</PRE></DIV>



<P>
Here, we get findfile folder in the Chrome folder and pass it directly to the
setPackageFolder function. The second argument to getFolder is the subdirectory which
we are going to install into, which doesn't have to exist. You can leave this argument
out entirely if you don't need one.
</P>

<H3>Setting Install Files</H3>

<P>
Next, you need to specify which files should be installed. This involves the use of
two functions, addDirectory and addFile. The addDirectory function tells the installer
that a directory from the XPI archive (and all of its contents) should be installed to
a particular location. The addFile is similar but for a single file.
</P>

<P>
Both the addDirectory and addFile functions have various forms. The simplest takes
only one argument, the directory from the installer to install to the assigned
installation directory.
</P>


<DIV CLASS="sample"><PRE>addDirectory ( dir );
addFile ( dir );

<B>Example:</B>

addDirectory("findfile");</PRE></DIV>



<P>
The example above will specify that the findfile directory from the installer archive
should be installed. We can call these functions multiple times to install other files.
</P>

<P>
Next, we'll want to register the find files in the chrome system so that it can be used
with a chrome URL. This can be done with the registerChrome function. It takes two
arguments, the first is the type of chrome to register (content, skin or locale). The
second is the directory containing the contents.rdf file to register. Because the find
files dialog contains content, a skin file and a locale file, registerChrome will need
to be called three times.
</P>


<DIV CLASS="sample"><PRE>
registerChrome(Install.CONTENT | Install.DELAYED_CHROME, getFolder(findDir, "content"));
registerChrome(Install.SKIN | Install.DELAYED_CHROME, getFolder(findDir, "skin"));
registerChrome(Install.LOCALE | Install.DELAYED_CHROME, getFolder(findDir, "locale"));</PRE></DIV>



<P>
The DELAYED_CHROME flag is used to indicate that the chrome should be installed
the next time Mozilla is run.
</P>

<H3>Installation Completion</H3>

<P>
The addDirectory and addFile functions don't copy any files. They only state which
files should be installed. Similarly, registerChrome only states that chrome should
be registered. To complete the process and begin copying files, call the
performInstall function. It takes no arguments.
</P>

<P>
The final script for installing the find files component is shown below:
</P>

<DIV CLASS="task">


Example 13.2.1:
<A HREF='examples/ex_xpiscript_1.js.txt'>Source</A>
<DIV CLASS="example"><PRE>initInstall("Find Files","/Xulplanet/Find Files","0.5.0.0");

findDir = getFolder("Chrome","findfile");
setPackageFolder(findDir);

addDirectory("findfile");

registerChrome(Install.CONTENT | Install.DELAYED_CHROME, getFolder(findDir, "content"));
registerChrome(Install.SKIN | Install.DELAYED_CHROME, getFolder(findDir, "skin"));
registerChrome(Install.LOCALE | Install.DELAYED_CHROME, getFolder(findDir, "locale"));

performInstall();</PRE></DIV>



</DIV>

<HR>
<P>
<A HREF="xpiadv.html">(Next)</A>
Next, we'll look at some additional install functions.

</P>
<P>

Examples:
  <A HREF='examples/ex_xpiscript_1.js.txt'>13.2.1</A>
</P>
</div>

<div class="navlinks-pnc">

  <a class="prevlink" title="13.1 - Creating an Installer"
     href="xpinstall.html">Previous</a>


  <a class="nextlink" title="13.3 - Additional Install Features"
     href="xpiadv.html">Next</a>

</div>

</div>

<hr class="edgesplit">

<div id="copyblock">
  Copyright (C) 1999 - 2004 XulPlanet.com
</div>

</body>
</html>

