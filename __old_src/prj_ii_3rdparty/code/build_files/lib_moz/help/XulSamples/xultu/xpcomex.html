<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<link rel="stylesheet" title="Default Style" href="styles/default/main.css" type="text/css">
<link rel="stylesheet" href="styles/default/xultu.css" type="text/css">


<link rel="stylesheet" href="styles/default/xultu-print.css" type="text/css" media="print">


<link rel="home"   href="http://www.xulplanet.com/"            title="http://www.XulPlanet.com/">
<link rel="search" href="http://www.xulplanet.com/cgi-bin/search/search.cgi" title="Search XulPlanet">
<link rel="author" href="http://www.xulplanet.com/ndeakin" title="Neil Deakin">
 <link rel="up" href="http://www.xulplanet.com/tutorials/" title="Up"> 
 <link rel="first" href="intro.html" title="First"> 
 <link rel="last" href="end.html" title="Last"> 

 <link rel="prev" href="xpcom.html"> 
 <link rel="next" href="trees.html"> 

<meta name="Description" content="Step by step tutorial of the XML User Interface Language">

<title>XulPlanet.com - XPCOM Examples</title>

</head>
<body>

<div id="header">
  <a href="http://www.xulplanet.com/">
    <img id="logo" src="images/xulplanet.png" width="215" height="65" alt="XUL Planet">
  </a>

<div id="locationlinks">
  <a href="http://www.xulplanet.com/">Home</a> &gt;

  <a href="http://www.xulplanet.com/tutorials/">Tutorials</a> :


  <a href="index.html">XUL Tutorial</a> :



 7.6 - XPCOM Examples 
</div>



</div>



<hr class="edgesplit">

<div id="sidebar">

<div id="search">
  <form action="/cgi-bin/search/search.cgi" method="get">
    Search:<br>
    <input id="search-box" name="Terms" type="text">
    <input type="submit" value="Go">
  </form>
</div>

<hr>

<ul class="sidebar-section-links">
  <li><a href="http://www.xulplanet.com/tutorials/xultu/allofit.zip">Single Document Version</a></li>
  <li><a href="http://www.xulplanet.com/tutorials/xultu/xultu.zip">Download the XUL Tutorial</a><br></li>
  <li><a href="http://www.xulplanet.com/references/elemref/">Element Reference</a></li>
  <li><a href="http://www.xulplanet.com/references/elemref/quickref.html">Quick Reference</a><br></li>
  <li><a href="keyref.html">Key Code Reference</a></li>
  <li><a href="templateex.html">Template Syntax Examples</a></li>
</ul>

<hr>



<OL id="sidebar-docs-index">
  <LI class="sidebar-section-title">Introduction
  <OL>
    <LI> <A HREF="intro.html">Introduction</A></LI>
    <LI> <A HREF="xulfile.html">XUL Structure</A></LI>
    <LI> <A HREF="chromeurl.html">The Chrome URL</A></LI>
    <LI> <A HREF="packaging.html">Contents.rdf Files</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Simple Elements
  <OL>
    <LI> <A HREF="window.html">Creating a Window</A></LI>
    <LI> <A HREF="buttons.html">Adding Buttons</A></LI>
    <LI> <A HREF="textimage.html">Adding Labels and Images</A></LI>
    <LI> <A HREF="inputs.html">Input Controls</A></LI>
    <LI> <A HREF="lists.html">List Controls</A></LI>
    <LI> <A HREF="progress.html">Progress Meters</A></LI>
    <LI> <A HREF="htmlelem.html">Adding HTML Elements</A></LI>
    <LI> <A HREF="springs.html">Using Spacers</A></LI>
    <LI> <A HREF="advbtns.html">More Button Features</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">The Box Model
  <OL>
    <LI> <A HREF="boxes.html">The Box Model</A></LI>
    <LI> <A HREF="boxstyle.html">Element Positioning</A></LI>
    <LI> <A HREF="boxdet.html">Box Model Details</A></LI>
    <LI> <A HREF="titledbox.html">Groupboxes</A></LI>
    <LI> <A HREF="boxfinal.html">Adding More Elements</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">More Layout Elements
  <OL>
    <LI> <A HREF="stacks.html">Stacks and Decks</A></LI>
    <LI> <A HREF="bulletins.html">Stack Positioning</A></LI>
    <LI> <A HREF="tabpanel.html">Tabboxes</A></LI>
    <LI> <A HREF="grids.html">Grids</A></LI>
    <LI> <A HREF="cpanels.html">Content Panels</A></LI>
    <LI> <A HREF="splitter.html">Splitters</A></LI>
    <LI> <A HREF="scroll.html">Scroll Bars</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Toolbars and Menus
  <OL>
    <LI> <A HREF="toolbar.html">Toolbars</A></LI>
    <LI> <A HREF="menubar.html">Simple Menu Bars</A></LI>
    <LI> <A HREF="advmenu.html">More Menu Features</A></LI>
    <LI> <A HREF="popups.html">Popup Menus</A></LI>
    <LI> <A HREF="menuscroll.html">Scrolling Menus</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Events and Scripts
  <OL>
    <LI> <A HREF="events.html">Adding Event Handlers</A></LI>
    <LI> <A HREF="advevents.html">More Event Handlers</A></LI>
    <LI> <A HREF="keyshort.html">Keyboard Shortcuts</A></LI>
    <LI> <A HREF="focus.html">Focus and Selection</A></LI>
    <LI> <A HREF="commands.html">Commands</A></LI>
    <LI> <A HREF="commandupdate.html">Updating Commands</A></LI>
    <LI> <A HREF="broadob.html">Broadcasters and Observers</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Document Object Model
  <OL>
    <LI> <A HREF="dom.html">Document Object Model</A></LI>
    <LI> <A HREF="dommodify.html">Modifying a XUL Interface</A></LI>
    <LI> <A HREF="domlists.html">Manipulating Lists</A></LI>
    <LI> <A HREF="boxobject.html">Box Objects</A></LI>
    <LI> <A HREF="xpcom.html">XPCOM Interfaces</A></LI>
    <LI> <SPAN CLASS="currentpage">XPCOM Examples</SPAN></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Trees
  <OL>
    <LI> <A HREF="trees.html">Trees</A></LI>
    <LI> <A HREF="advtrees.html">More Tree Features</A></LI>
    <LI> <A HREF="seltree.html">Tree Selection</A></LI>
    <LI> <A HREF="treeview.html">Custom Tree Views</A></LI>
    <LI> <A HREF="treeviewdet.html">Tree View Details</A></LI>
    <LI> <A HREF="treeboxobject.html">Tree Box Objects</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">RDF and Templates
  <OL>
    <LI> <A HREF="intrordf.html">Introduction to RDF</A></LI>
    <LI> <A HREF="templates.html">Templates</A></LI>
    <LI> <A HREF="treetempl.html">Trees and Templates</A></LI>
    <LI> <A HREF="datasrc.html">RDF Datasources</A></LI>
    <LI> <A HREF="advrules.html">Advanced Rules</A></LI>
    <LI> <A HREF="persist.html">Persistent Data</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Skins and Locales
  <OL>
    <LI> <A HREF="style.html">Adding Style Sheets</A></LI>
    <LI> <A HREF="treestyle.html">Styling a Tree</A></LI>
    <LI> <A HREF="defskin.html">Modifying the Default Skin</A></LI>
    <LI> <A HREF="cskin.html">Creating a Skin</A></LI>
    <LI> <A HREF="locale.html">Localization</A></LI>
    <LI> <A HREF="locprops.html">Property Files</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Bindings
  <OL>
    <LI> <A HREF="introxbl.html">Introduction to XBL</A></LI>
    <LI> <A HREF="xblcontent.html">Anonymous Content</A></LI>
    <LI> <A HREF="xblatin.html">XBL Attribute Inheritance</A></LI>
    <LI> <A HREF="xblprops.html">Adding Properties</A></LI>
    <LI> <A HREF="xblmethods.html">Adding Methods</A></LI>
    <LI> <A HREF="xblevents.html">Adding Event Handlers</A></LI>
    <LI> <A HREF="xblinherit.html">XBL Inheritance</A></LI>
    <LI> <A HREF="xblex.html">XBL Example</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Specialized Window Types
  <OL>
    <LI> <A HREF="featwin.html">Features of a Window</A></LI>
    <LI> <A HREF="dialogs.html">Creating Dialogs</A></LI>
    <LI> <A HREF="filedialog.html">Open and Save Dialogs</A></LI>
    <LI> <A HREF="wizard.html">Creating a Wizard</A></LI>
    <LI> <A HREF="advwiz.html">More Wizards</A></LI>
    <LI> <A HREF="overlay.html">Overlays</A></LI>
    <LI> <A HREF="crosspov.html">Cross Package Overlays</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Installation
  <OL>
    <LI> <A HREF="xpinstall.html">Creating an Installer</A></LI>
    <LI> <A HREF="xpiscript.html">Install Scripts</A></LI>
    <LI> <A HREF="xpiadv.html">Additional Install Features</A></LI>
  </OL>
</OL>

</div>



<div id="content">

<div class="navlinks-pnc">

  <a class="prevlink" title="7.5 - XPCOM Interfaces"
     href="xpcom.html">Previous</a>


  <a class="nextlink" title="8.1 - Trees"
     href="trees.html">Next</a>

</div>

<div class="xultu-content">

<h2>XPCOM Examples</h2>

<P>
This section provides some examples of using XPCOM along with some
additional interfaces.
</P>

<H3>Window Management</H3>

<P>
The list of currently open Mozilla windows can be used as an RDF datasource.
This allows you to create a Window menu with a list of the currently open
windows in the application. The datasource for this is
<SPAN CLASS="aval">rdf:window-mediator</SPAN>. We can use this as in the
following example:
</P>


Example 7.6.1:
<A HREF='examples/ex_xpcomex_1.xul.txt'>Source</A>
<DIV CLASS="examplec"><PRE>&lt;toolbox&gt;
 &lt;menubar id="windowlist-menubar"&gt;
  &lt;menu label="Window"&gt;
   &lt;menupopup id="window-menu" datasources="rdf:window-mediator" ref="NC:WindowMediatorRoot"&gt;
    &lt;template&gt;
     &lt;rule&gt;
      &lt;menuitem uri="rdf:*" label="rdf:http://home.netscape.com/NC-rdf#Name"/&gt;
     &lt;/rule&gt;
    &lt;/template&gt;
   &lt;/menupopup&gt;
  &lt;/menu&gt;          
 &lt;/menubar&gt;
&lt;/toolbox&gt;</PRE></DIV>



<P>
A Window menu will be created with a list of all the open windows. Try this
example by opening a number of browser windows and you'll see that they are
all listed on the menu. This is fine for displaying a list of open windows,
but we would like to enhance this so that clicking on the menu item will
switch to that window. This is accomplished by using the window mediator
component. It implements the interface nsIWindowDataSource. The code below
shows how to get a component which implements it:
</P>


<DIV CLASS="sample"><PRE>var wmdata = Components.classes["@mozilla.org/rdf/datasource;1?name=window-mediator"].getService();
wmdata.QueryInterface(Components.interfaces.nsIWindowDataSource);</PRE></DIV>



<P>
This code retrieves a window mediator data source component. The component used
here is the same one that handles the window-mediator RDF datasource. You can
also get this component through the RDF service, which is another service that
manages RDF datasources.
</P>

<P>
The nsIWindowDataSource interface has a function
<SPAN CLASS="attrib">getWindowForResource</SPAN>, which can be used to get the
window given a resource. In the earlier example, we generated the
list of windows and added it to a menu via a template. The template
generates an <SPAN CLASS="attrib">id</SPAN> attribute on each
<A CLASS="tag" HREF="elemref/ref_menuitem.html">menuitem</A> element. The value of this attribute can
be used as the resource. That means that in order to switch the window
focus, we need to do the following:
</P>

<OL>
  <LI>Determine the element that the user clicked on.</LI>
  <LI>Get the value of the <SPAN CLASS="attrib">id</SPAN> attribute from the
      element.</LI>
  <LI>Pass this value to <SPAN CLASS="attrib">getWindowFromResource</SPAN> to get
      a window object.</LI>
  <LI>Switch the focus to this window.</LI>
</OL>

<P>
The example below shows how we might do this:
</P>


<DIV CLASS="sample"><PRE>&lt;toolbox&gt;
 &lt;menubar id="windowlist-menubar"&gt;
  &lt;menu label="Window" oncommand="switchFocus(event.target);"&gt;
   &lt;menupopup id="window-menu" datasources="rdf:window-mediator" ref="NC:WindowMediatorRoot"&gt;
    &lt;template&gt;
     &lt;rule&gt;
      &lt;menuitem uri="rdf:*" label="rdf:http://home.netscape.com/NC-rdf#Name"/&gt;
     &lt;/rule&gt;
    &lt;/template&gt;
   &lt;/menupopup&gt;
  &lt;/menu&gt;          
 &lt;/menubar&gt;
&lt;/toolbox&gt;


function switchFocus(elem)
{
  var mediator = Components.classes["@mozilla.org/rdf/datasource;1?name=window-mediator"].getService();
  mediator.QueryInterface(Components.interfaces.nsIWindowDataSource);

  var resource = elem.getAttribute('id');
  switchwindow = mediator.getWindowForResource(resource);

  if (switchwindow){
    switchwindow.focus();
  }
}</PRE></DIV>



<P>
A command handler was added to the menu element which calls the function with
a parameter of the element that was selected from the menu. The function
<SPAN CLASS="attrib">switchFocus</SPAN> first gets a reference to a component
which implements the window mediator interface. Next, we get the
<SPAN CLASS="attrib">id</SPAN> attribute for the element. We can use the value
of the <SPAN CLASS="attrib">id</SPAN> attribute as the resource. The function
<SPAN CLASS="attrib">getWindowForResource</SPAN> takes the resource and returns
a window that matches it. This window, stored in the
<SPAN CLASS="attrib">switchwindow</SPAN> variable, is the same as the JavaScript
window object. This means that you can call any of the functions provided by it,
one of which is the <A CLASS="tag" HREF="elemref/ref_focus.html">focus</A> function.
</P>

<H3>Cookies</H3>

<P>
Next, we will get a list of cookies that have been saved in the browser.
The cookie service can be used for such a purpose. It implements the
nsICookieManager interface which can be used to enumerate over all of the
cookies. Here is an example which populates a menu list with the names of all
of the cookies set from MozillaZine.
</P>


<DIV CLASS="sample"><PRE>&lt;script&gt;

function getCookies()
{
  var menu = document.getElementById("cookieMenu");
  menu.removeAllItems();

  var cookieManager = Components.classes["@mozilla.org/cookiemanager;1"]
                        .getService(Components.interfaces.nsICookieManager);

  var iter = cookieManager.enumerator;
  while (iter.hasMoreElements()){
    var cookie = iter.getNext();
    if (cookie instanceof Components.interfaces.nsICookie){
      if (cookie.host == "www.mozillazine.org")
        menu.appendItem(cookie.name,cookie.value);
    }
  }
}
&lt;/script&gt;

&lt;hbox&gt;
  &lt;menulist id="cookieMenu" onpopupshowing="getCookies();"/&gt;
&lt;/hbox&gt;</PRE></DIV>



<P>
The getCookies function will be called whenever the menu is opened, as
indicated by the <SPAN CLASS="attrib">onpopupshowing</SPAN> attribute on the
<A CLASS="tag" HREF="elemref/ref_menulist.html">menulist</A>. The first two lines of getCookies get the
menulist and remove all of the existing items in the menu. This is done
because getCookies is called every time the menu is opened and we don't want
to leave the old items there each time.
</P>

<P>
Next, the cookie manager is retrieved. The cookie manager has an enumerator
method which returns an object which implements nsISimpleEnumerator. This
can be used to iterate over all of the cookies. An enumerator has a
hasMoreElements method which will return true until we get to the last cookie.
The getNext method gets a cookie and moves the enumerator index to the next
cookie. Since an enumerator just returns a generic object, we need to
QueryInterface it to an nsICookie before we can use it. In this case, we just
use the instanceof operator to accomplish this.
</P>

<P>
Finally, an item is added to the menu for the cookie. The host, name and value
properties of the cookie are used for this. Menus have an appendItem function
which can be used to add an item to the menu, given a label and a value.
</P>

<HR>
<P>
<A HREF="trees.html">(Next)</A>
Next, we'll look at how to create trees.

</P>
<P>

Examples:
  <A HREF='examples/ex_xpcomex_1.xul.txt'>7.6.1</A>
</P>
</div>

<div class="navlinks-pnc">

  <a class="prevlink" title="7.5 - XPCOM Interfaces"
     href="xpcom.html">Previous</a>


  <a class="nextlink" title="8.1 - Trees"
     href="trees.html">Next</a>

</div>

</div>

<hr class="edgesplit">

<div id="copyblock">
  Copyright (C) 1999 - 2004 XulPlanet.com
</div>

</body>
</html>

