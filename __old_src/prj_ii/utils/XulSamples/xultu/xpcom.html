<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<link rel="stylesheet" title="Default Style" href="styles/default/main.css" type="text/css">
<link rel="stylesheet" href="styles/default/xultu.css" type="text/css">


<link rel="stylesheet" href="styles/default/xultu-print.css" type="text/css" media="print">


<link rel="home"   href="http://www.xulplanet.com/"            title="http://www.XulPlanet.com/">
<link rel="search" href="http://www.xulplanet.com/cgi-bin/search/search.cgi" title="Search XulPlanet">
<link rel="author" href="http://www.xulplanet.com/ndeakin" title="Neil Deakin">
 <link rel="up" href="http://www.xulplanet.com/tutorials/" title="Up"> 
 <link rel="first" href="intro.html" title="First"> 
 <link rel="last" href="end.html" title="Last"> 

 <link rel="prev" href="boxobject.html"> 
 <link rel="next" href="xpcomex.html"> 

<meta name="Description" content="Step by step tutorial of the XML User Interface Language">

<title>XulPlanet.com - XPCOM Interfaces</title>

</head>
<body>

<div id="header">
  <a href="http://www.xulplanet.com/">
    <img id="logo" src="images/xulplanet.png" width="215" height="65" alt="XUL Planet">
  </a>

<div id="locationlinks">
  <a href="http://www.xulplanet.com/">Home</a> &gt;

  <a href="http://www.xulplanet.com/tutorials/">Tutorials</a> :


  <a href="index.html">XUL Tutorial</a> :



 7.5 - XPCOM Interfaces 
</div>



</div>



<hr class="edgesplit">

<div id="sidebar">

<div id="search">
  <form action="/cgi-bin/search/search.cgi" method="get">
    Search:<br>
    <input id="search-box" name="Terms" type="text">
    <input type="submit" value="Go">
  </form>
</div>

<hr>

<ul class="sidebar-section-links">
  <li><a href="http://www.xulplanet.com/tutorials/xultu/allofit.zip">Single Document Version</a></li>
  <li><a href="http://www.xulplanet.com/tutorials/xultu/xultu.zip">Download the XUL Tutorial</a><br></li>
  <li><a href="http://www.xulplanet.com/references/elemref/">Element Reference</a></li>
  <li><a href="http://www.xulplanet.com/references/elemref/quickref.html">Quick Reference</a><br></li>
  <li><a href="keyref.html">Key Code Reference</a></li>
  <li><a href="templateex.html">Template Syntax Examples</a></li>
</ul>

<hr>



<OL id="sidebar-docs-index">
  <LI class="sidebar-section-title">Introduction
  <OL>
    <LI> <A HREF="intro.html">Introduction</A></LI>
    <LI> <A HREF="xulfile.html">XUL Structure</A></LI>
    <LI> <A HREF="chromeurl.html">The Chrome URL</A></LI>
    <LI> <A HREF="packaging.html">Contents.rdf Files</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Simple Elements
  <OL>
    <LI> <A HREF="window.html">Creating a Window</A></LI>
    <LI> <A HREF="buttons.html">Adding Buttons</A></LI>
    <LI> <A HREF="textimage.html">Adding Labels and Images</A></LI>
    <LI> <A HREF="inputs.html">Input Controls</A></LI>
    <LI> <A HREF="lists.html">List Controls</A></LI>
    <LI> <A HREF="progress.html">Progress Meters</A></LI>
    <LI> <A HREF="htmlelem.html">Adding HTML Elements</A></LI>
    <LI> <A HREF="springs.html">Using Spacers</A></LI>
    <LI> <A HREF="advbtns.html">More Button Features</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">The Box Model
  <OL>
    <LI> <A HREF="boxes.html">The Box Model</A></LI>
    <LI> <A HREF="boxstyle.html">Element Positioning</A></LI>
    <LI> <A HREF="boxdet.html">Box Model Details</A></LI>
    <LI> <A HREF="titledbox.html">Groupboxes</A></LI>
    <LI> <A HREF="boxfinal.html">Adding More Elements</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">More Layout Elements
  <OL>
    <LI> <A HREF="stacks.html">Stacks and Decks</A></LI>
    <LI> <A HREF="bulletins.html">Stack Positioning</A></LI>
    <LI> <A HREF="tabpanel.html">Tabboxes</A></LI>
    <LI> <A HREF="grids.html">Grids</A></LI>
    <LI> <A HREF="cpanels.html">Content Panels</A></LI>
    <LI> <A HREF="splitter.html">Splitters</A></LI>
    <LI> <A HREF="scroll.html">Scroll Bars</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Toolbars and Menus
  <OL>
    <LI> <A HREF="toolbar.html">Toolbars</A></LI>
    <LI> <A HREF="menubar.html">Simple Menu Bars</A></LI>
    <LI> <A HREF="advmenu.html">More Menu Features</A></LI>
    <LI> <A HREF="popups.html">Popup Menus</A></LI>
    <LI> <A HREF="menuscroll.html">Scrolling Menus</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Events and Scripts
  <OL>
    <LI> <A HREF="events.html">Adding Event Handlers</A></LI>
    <LI> <A HREF="advevents.html">More Event Handlers</A></LI>
    <LI> <A HREF="keyshort.html">Keyboard Shortcuts</A></LI>
    <LI> <A HREF="focus.html">Focus and Selection</A></LI>
    <LI> <A HREF="commands.html">Commands</A></LI>
    <LI> <A HREF="commandupdate.html">Updating Commands</A></LI>
    <LI> <A HREF="broadob.html">Broadcasters and Observers</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Document Object Model
  <OL>
    <LI> <A HREF="dom.html">Document Object Model</A></LI>
    <LI> <A HREF="dommodify.html">Modifying a XUL Interface</A></LI>
    <LI> <A HREF="domlists.html">Manipulating Lists</A></LI>
    <LI> <A HREF="boxobject.html">Box Objects</A></LI>
    <LI> <SPAN CLASS="currentpage">XPCOM Interfaces</SPAN></LI>
    <LI> <A HREF="xpcomex.html">XPCOM Examples</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Trees
  <OL>
    <LI> <A HREF="trees.html">Trees</A></LI>
    <LI> <A HREF="advtrees.html">More Tree Features</A></LI>
    <LI> <A HREF="seltree.html">Tree Selection</A></LI>
    <LI> <A HREF="treeview.html">Custom Tree Views</A></LI>
    <LI> <A HREF="treeviewdet.html">Tree View Details</A></LI>
    <LI> <A HREF="treeboxobject.html">Tree Box Objects</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">RDF and Templates
  <OL>
    <LI> <A HREF="intrordf.html">Introduction to RDF</A></LI>
    <LI> <A HREF="templates.html">Templates</A></LI>
    <LI> <A HREF="treetempl.html">Trees and Templates</A></LI>
    <LI> <A HREF="datasrc.html">RDF Datasources</A></LI>
    <LI> <A HREF="advrules.html">Advanced Rules</A></LI>
    <LI> <A HREF="persist.html">Persistent Data</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Skins and Locales
  <OL>
    <LI> <A HREF="style.html">Adding Style Sheets</A></LI>
    <LI> <A HREF="treestyle.html">Styling a Tree</A></LI>
    <LI> <A HREF="defskin.html">Modifying the Default Skin</A></LI>
    <LI> <A HREF="cskin.html">Creating a Skin</A></LI>
    <LI> <A HREF="locale.html">Localization</A></LI>
    <LI> <A HREF="locprops.html">Property Files</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Bindings
  <OL>
    <LI> <A HREF="introxbl.html">Introduction to XBL</A></LI>
    <LI> <A HREF="xblcontent.html">Anonymous Content</A></LI>
    <LI> <A HREF="xblatin.html">XBL Attribute Inheritance</A></LI>
    <LI> <A HREF="xblprops.html">Adding Properties</A></LI>
    <LI> <A HREF="xblmethods.html">Adding Methods</A></LI>
    <LI> <A HREF="xblevents.html">Adding Event Handlers</A></LI>
    <LI> <A HREF="xblinherit.html">XBL Inheritance</A></LI>
    <LI> <A HREF="xblex.html">XBL Example</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Specialized Window Types
  <OL>
    <LI> <A HREF="featwin.html">Features of a Window</A></LI>
    <LI> <A HREF="dialogs.html">Creating Dialogs</A></LI>
    <LI> <A HREF="filedialog.html">Open and Save Dialogs</A></LI>
    <LI> <A HREF="wizard.html">Creating a Wizard</A></LI>
    <LI> <A HREF="advwiz.html">More Wizards</A></LI>
    <LI> <A HREF="overlay.html">Overlays</A></LI>
    <LI> <A HREF="crosspov.html">Cross Package Overlays</A></LI>
  </OL>
  </LI>
  <LI class="sidebar-section-title">Installation
  <OL>
    <LI> <A HREF="xpinstall.html">Creating an Installer</A></LI>
    <LI> <A HREF="xpiscript.html">Install Scripts</A></LI>
    <LI> <A HREF="xpiadv.html">Additional Install Features</A></LI>
  </OL>
</OL>

</div>



<div id="content">

<div class="navlinks-pnc">

  <a class="prevlink" title="7.4 - Box Objects"
     href="boxobject.html">Previous</a>


  <a class="nextlink" title="7.6 - XPCOM Examples"
     href="xpcomex.html">Next</a>

</div>

<div class="xultu-content">

<h2>XPCOM Interfaces</h2>

<P>
In this section, we'll take a brief look at XPCOM (Cross-platform
Component Object Model), which is the Object system that Mozilla uses.
</P>

<H3>Calling Native Objects</H3>

<P>
By using XUL we can build a complex user interface. We can attach scripts
which modify the interface and perform tasks. However, there are quite a
number of things that cannot be performed directly with JavaScript. For
example, if we wanted to create a mail application, we would need to write
scripts which would connect to mail servers to retrieve and send mail.
JavaScript does not have the capability to do such things.
</P>

<P>
The only way to handle this would be to write native code that would get mail.
We also need to have a way for our scripts to call the native code easily.
Mozilla provides such a method which involves using XPCOM (Cross-platform
Component Object Model).
</P>

<H3>About XPCOM</H3>

<P>
Mozilla is constructed from a collection of components, each of which performs
a certain task. For example, there is a component for each menu, button and
element. The components are constructed from a number of definitions called
interfaces.
</P>

<P>
An interface in Mozilla is a definition of a set of functionality that could
be implemented by components. Components are what implement the code in Mozilla
that does things. Each component implements the functionality as described by
interfaces. A single component might implement multiple interfaces. And multiple
components might implement the same interface.
</P>

<P>
Let's take an example of a file component. An interface would need to be created
which describes properties and functions that can be performed on files. A file
would need properties for its name, modification date and its size. Functions
of a file would include moving, copying and deleting it.
</P>

<P>
The File interface only describes the characteristics of a file, it does not
implement it. The implementation of the File interface is left to a component.
The component will have code which can retrieve the file's name, date and size.
In addition, it will have code which copies and renames it.
</P>

<P>
We don't care how the component implements it, as long as it implements the
interface correctly. Of course, we'll have different implementations anyway, one
for each platform. The Windows and Macintosh versions of a file component would
be significantly different. However, they would both implement the same interface.
Thus, we can use a component by accessing it using the functions we know from the
interface.
</P>

<P>
In Mozilla, interfaces are preceded by 'nsI' so that they are easily recognized as
interfaces. For example, the nsIAddressBook is the interface for interacting with
an address book, nsISound is used for playing files and nsILocalFile is used for
files.
</P>

<P>
XPCOM components are typically implemented natively, which means that they
generally do things that JavaScript cannot do itself. However, there is a way
in which you can call them, which we will see shortly. We can call any of the
functions provided by the component as described by the interfaces it implements.
For example, once we have a component, we can check if it implements nsISound,
and, if so, we can play sound through it.
</P>

<P>
The process of calling XPCOM from a script is called XPConnect, which is a layer
which translates script objects into native objects.
</P>

<H3>Creating XPCOM Objects</H3>

<P>
There are three steps to calling an XPCOM component.
</P>

<OL>
  <LI>Get a component</LI>
  <LI>Get the part of the component that implements the interface that we want
      to use.</LI>
  <LI>Call the function we need</LI>
</OL>

<P>
Once you've done the first two steps, you can repeat the last step as often as
necessary. Let's say we want to rename a file. For this we can use the nsILocalFile
interface. The first step is getting a file component. Second, we query the
file component and get the portion of it that implements the nsILocalFile interface.
Finally, we call functions provided by the interface. This interface is used to
represent a single file.
</P>

<P>
We've seen that interfaces are always named starting with 'nsI'. Components,
however, are referred to using a URI syntax. Mozilla stores a list of all the
components that are available in its own registry. A particular user can
install new components as needed. It works much like plug-ins.
</P>

<P>
Mozilla provides a file component, that is, a component that implements
nsILocalFile. This component can be referred to using the URI
'@mozilla.org/file/local;1'. The component: URI scheme is used to
specify a component. Other components can be referred to in a similar way.
</P>

<P>
The URI of the component can be used to get the component. You can get a component
using JavaScript code like that below:
</P>


<DIV CLASS="sample"><PRE>var aFile = Components.classes["@mozilla.org/file/local;1"].createInstance();</PRE></DIV>



<P>
The file component is retrieved and stored in the aFile variable.
<SPAN CLASS="attrib">Components</SPAN> in the example above refers to a
general object that provides some component related functions. Here, we
get a component class from the <SPAN CLASS="attrib">classes</SPAN>
property. The <SPAN CLASS="attrib">classes</SPAN> property is an array of
all of the available components. To get a different component, just replace
the URI inside the square brackets with the URI of the component you want
to use. Finally, an instance is created with the
<SPAN CLASS="attrib">createInstance</SPAN> function.
</P>

<P>
You should check the return value of createInstance to ensure that it is not null,
which would indicate that the component does not exist.
</P>

<P>
However, at this point, we only have a reference to the file component itself.
In order to call the functions of it we need to get one of its interfaces, in this
case nsILocalFile. A second line of code needs to be added as follows:
</P>


<DIV CLASS="sample"><PRE>var aFile = Components.classes["@mozilla.org/file/local;1"].createInstance();
if (aFile) aFile.QueryInterface(Components.interfaces.nsILocalFile);</PRE></DIV>



<P>
The function <SPAN CLASS="attrib">QueryInterface</SPAN> is a function
provided by all components which can be used to get a specific interface
of that component. This function takes one parameter, the interface that
you want to get. The <SPAN CLASS="attrib">interfaces</SPAN> property of the
<SPAN CLASS="attrib">Components</SPAN> object contains a list of all the
interfaces that are available. Here, we use the nsILocalFile interface and
pass it as a parameter to <SPAN CLASS="attrib">QueryInterface</SPAN>. The
result is that aFile will be a reference to the part of the component that
implements the nsILocalFile interface.
</P>

<P>
The two JavaScript lines above can be used to get any interface of any
component. Just replace the component name with the name of the component
you want to use and change the interface name. You can also use any
variable names of course. For example, to get a sound interface, you can
do the following:
</P>


<DIV CLASS="sample"><PRE>var sound = Components.classes["@mozilla.org/sound;1"].createInstance();
if (sound) sound.QueryInterface(Components.interfaces.nsISound);</PRE></DIV>



<P>
XPCOM interfaces can inherit from other interfaces. The interfaces that inherit
from others have their own functions and the functions of all the interfaces that
they inherit from. All interfaces inherit from a top-level interface called
nsISupports. It has one function supplied to JavaScript, QueryInterface, which we
have already seen. Because the interface nsISupports is implemented by all
components, the function QueryInterface function is available in every component.
</P>

<P>
Several components may implement the same interface. Typically, they might
be subclasses of the original but not necessarily. Any component may implement
the functionality of nsILocalFile. In addition, a component may implement several
interfaces. It is for these reasons that two steps are involved in getting an
interface to call functions through.
</P>

<P>
However, there is a shortcut we can use because we'll often use both of these
lines together:
</P>


<DIV CLASS="sample"><PRE>var aLocalFile = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);</PRE></DIV>



<P>
This will do the same thing as the two lines but in one line of code.
It eliminates the need to create the instance and then query it for an
interface in two separate steps.
</P>

<P>
If you call QueryInterface on an object and the requested interface is not
supported by an object, an exception is thrown. If you're not sure that an
interface is supported by a component, you can use the instanceof operator
to check:
</P>


<DIV CLASS="sample"><PRE>var aFile = Components.classes["@mozilla.org/file/local;1"].createInstance();
if (aFile instanceof Components.interfaces.nsILocalFile){
  // do something
}</PRE></DIV>



<P>
The instanceof operator returns true if aFile implements the nsILocalFile
interface. This also has the side effect of calling QueryInterface, so aFile
will be a valid nsILocalFile afterwards.
</P>

<H3>Calling the Functions of an Interface</H3>

<P>
Now that we have an object that refers to a component with the nsILocalFile
interface, we can call the functions of nsILocalFile through it. The table
below shows some of the properties and methods of the nsILocalFile interface.
</P>

<TABLE BORDER=1>
  <TR>
    <TD>initWithPath</TD>
    <TD>This method is used to initialize the path and filename for
        the nsILocalFile. The first parameter should be the file path, such as
        '/usr/local/mozilla'</TD>
  </TR>
  <TR>
    <TD>leafName</TD>
    <TD>The filename without the directory part</TD>
  </TR>
  <TR>
    <TD>fileSize</TD>
    <TD>The size of the file</TD>
  </TR>
  <TR>
    <TD>isDirectory()</TD>
    <TD>Returns true if the nsILocalFile represents a directory
  </TR>
  <TR>
    <TD>delete(recursive)</TD>
    <TD>Deletes a file. If the recursive parameter is true,
        a directory and all of its files and subdirectories will also be deleted.</TD>
  </TR>
  <TR>
    <TD>copyTo(directory,newname)</TD>
    <TD>Copies a file to another directory, optionally renaming the file. The
        directory should be a nsILocalFile holding the directory to copy the
        file to.</TD>
  </TR>
  <TR>
    <TD>moveTo(directory,newname)</TD>
    <TD>Moves a file to another directory, or renames a file. The directory
        should be a nsILocalFile holding the directory to move the file to.</TD>
  </TR>
</TABLE>

<P>
In order to delete a file we first need to assign a file to the nsILocalFile.
We can call the method <SPAN CLASS="attrib">initWithPath</SPAN> to indicate
which file we mean. Just assign the path of the file to this property. Next, we
call the <SPAN CLASS="attrib">delete</SPAN> function. It takes one parameter
which is whether to delete recursively. The code below demonstrates these two steps:
</P>


<DIV CLASS="sample"><PRE>var aFile = Components.classes["@mozilla.org/file/local;1"].createInstance();
if (aFile instanceof Components.interfaces.nsILocalFile){
  aFile.initWithPath("/mozilla/testfile.txt");
  aFile.delete(false);
}</PRE></DIV>



<P>
This code will take the file at /mozilla/testfile.txt and delete it. Try this
example by adding this code to an event handler. You should change the filename
to an existing file that you have that you would like to delete.
</P>

<P>
In the functions table above, you will see two functions
<SPAN CLASS="attrib">copyTo</SPAN> and
<SPAN CLASS="attrib">moveTo</SPAN>. These two functions can be used
to copy files and move files respectively. Note that they do not take
a string parameter for the directory to copy or move to, but instead
take an nsILocalFile. That means that you'll need to get two file
components. The example below shows how to copy a file. 
</P>


<DIV CLASS="sample"><PRE>function copyFile(sourcefile,destdir)
{
  // get a component for the file to copy
  var aFile = Components.classes["@mozilla.org/file/local;1"]
    .createInstance(Components.interfaces.nsILocalFile);
  if (!aFile) return false;

  // get a component for the directory to copy to
  var aDir = Components.classes["@mozilla.org/file/local;1"]
    .createInstance(Components.interfaces.nsILocalFile);
  if (!aDir) return false;

  // next, assign URLs to the file components
  aFile.initWithPath(sourcefile);
  aDir.initWithPath(destdir);

  // finally, copy the file, without renaming it
  aFile.copyTo(aDir,null);
}

copyFile("/mozilla/testfile.txt","/etc");</PRE></DIV>



<H3>XPCOM Services</H3>

<P>
Some XPCOM components are special components called services. You do not create
instances of them because only one should exist. Services provide general
functions which either get or set global data or perform operations on other
objects. Instead of calling <SPAN CLASS="attrib">createInstance</SPAN>, you
call <SPAN CLASS="attrib">getService</SPAN> to get a reference to the service
component. Other than that, services are not very different from other components.
</P>

<P>
One such service provided with Mozilla is a bookmarks service. It allows you to
add bookmarks to the user's current bookmark list. An example is shown below:
</P>


<DIV CLASS="sample"><PRE>var bmarks = Components.classes["@mozilla.org/browser/bookmarks-service;1"].getService();
bmarks.QueryInterface(Components.interfaces.nsIBookmarksService);
bmarks.addBookmarkImmediately("http://www.mozilla.org","Mozilla",0,null);</PRE></DIV>



<P>
First, the component "@mozilla.org/browser/bookmarks-service;1" is retrieved
and its service is placed in the variable <SPAN CLASS="attrib">bmarks</SPAN>.
We use <SPAN CLASS="attrib">QueryInterface</SPAN> to get the nsIBookmarksService
interface. The function <SPAN CLASS="attrib">addBookmarkImmediately</SPAN> provided
by this interface can be used to add bookmarks. The first two parameters to this
function are the bookmark's URL and its title. The third parameter is the bookmark
type which will normally be 0 and the last parameter is the character encoding of
the document being bookmarked, which may be null.
</P>

<HR>
<P>
<A HREF="xpcomex.html">(Next)</A>
Next, we will see some of the interfaces provided with Mozilla that we can use.
</P>
</div>

<div class="navlinks-pnc">

  <a class="prevlink" title="7.4 - Box Objects"
     href="boxobject.html">Previous</a>


  <a class="nextlink" title="7.6 - XPCOM Examples"
     href="xpcomex.html">Next</a>

</div>

</div>

<hr class="edgesplit">

<div id="copyblock">
  Copyright (C) 1999 - 2004 XulPlanet.com
</div>

</body>
</html>

